#!/usr/bin/env ruby
# -*- coding: UTF-8 -*-

require 'yaml'
require "fileutils"
require "redcarpet"
require "pars"

markdown = Redcarpet::Markdown.new(Redcarpet::Render::HTML,
									autolink: true, tables: true,
									prettify: true,
									fenced_code_blocks: true)






if Pars.isParsDir? then

	$default_settings = {
		"title" => "Title of site",
		"description" => "Yet another static website"
	}
	
	$user_settings = File.open(".pars.yml") { |file| YAML.load(file) } 

	$settings = {
			"title" => if $user_settings then if $user_settings["title"] != nil then $user_settings["title"] else $default_settings["title"] end else $default_settings["title"] end,
			"description" => if $user_settings then if $user_settings["description"] != nil then $user_settings["description"] else $default_settings["description"] end else $default_settings["description"] end
		} 

	puts $settings

	if Pars.anyPost? then

		header = File.open("view/header.html").read
		footer = File.open("view/footer.html").read

		File.delete('index.html') if File.exist?('index.html')

		index = File.open("index.html","a")

		# Pars.generate

		# Dir.foreach( Dir.pwd + "/posts" ) do |item|
			
		# 	puts item

		# 	# Remove . and .. file in from list
		# 	next if item == '.' or item == '..'


		# 	data = File.open(Dir.pwd + "/posts/" + item)

		# 	repc = { ".md" => ".html"}


		# 	FileUtils.touch( item.sub!(".md", ".html") )
				
		# 	File.open( Dir.pwd + "/" + item , 'w' ) do |file|
		# 		file.write( header + markdown.render(data.read) + footer)
		# 	end

		# 	index.write('<li><a href='+item +'>'+ item.sub!(".html", "") + '</a></li>')

		# 	data.close

		# 	puts "\n"
		# end

		index.close
	else

		puts "posts not exists"
	end

else
	puts "Here is not a pars project."
end
